<!-- dashboard.html -->
<!doctype html>
<html lang="en">
<head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Dashboard</title><script src="https://cdn.tailwindcss.com"></script></head>
<body class="bg-gray-100">

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script src="js/firebase.js"></script>

<nav class="bg-white p-4 shadow"><div class="max-w-6xl mx-auto flex justify-between"><a href="project.html" class="font-bold text-blue-600">Student PBL</a><button onclick="signOutUser()" class="bg-gray-200 px-3 py-1 rounded">Logout</button></div></nav>

<main class="max-w-6xl mx-auto p-6 pt-20">
  <h1 class="text-xl font-bold">Your Uploaded Projects</h1>
  <div id="grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-6"></div>
  <p id="no" class="hidden mt-6 text-gray-600">No uploads yet.</p>
</main>

<script>
const grid = document.getElementById('grid'), no = document.getElementById('no');

auth.onAuthStateChanged(async user=>{
  if(!user){ alert('Login first'); location.href='index.html'; return; }
  try {
    const q = await db.collection('projects').where('userId','==', user.uid).orderBy('timestamp','desc').get();
    if(q.empty){ no.classList.remove('hidden'); return; }
    q.forEach(doc=>{
      const p = doc.data();
      const id = doc.id;
      grid.innerHTML += `
        <div class="bg-white p-4 rounded shadow">
          <h3 class="font-bold">${p.title}</h3>
          <p class="text-sm text-gray-600">${p.category}</p>
          <p class="mt-2 text-gray-700">${p.description.substring(0,120)}...</p>
          <div class="mt-3 flex gap-2">
            <a href="${p.driveLink}" target="_blank" class="text-blue-600">Open Drive</a>
            <button onclick="editProject('${id}')" class="px-3 py-1 bg-yellow-500 text-white rounded">Edit</button>
            <button onclick="deleteProject('${id}')" class="px-3 py-1 bg-red-500 text-white rounded">Delete</button>
          </div>
        </div>
      `;
    });
  } catch(err){ alert('Failed load: '+err.message); console.error(err); }
});

function editProject(id){ location.href = `edit.html?id=${id}`; }

function deleteProject(id){
  if(!confirm('Delete this project?')) return;
  db.collection('projects').doc(id).delete().then(()=> location.reload()).catch(e=>alert('Delete failed: '+e.message));
}
</script>
</body>
</html>
